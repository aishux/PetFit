<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pet Behaviour Chatbot</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        display: flex;
        height: 100vh;
        background: #f7f8fa;
    }
    /* Sidebar */
    .sidebar {
        width: 260px;
        background: #fff;
        border-right: 1px solid #ddd;
        display: flex;
        flex-direction: column;
    }
    .sidebar-header {
        padding: 15px;
        border-bottom: 1px solid #eee;
    }
    .new-chat-btn {
        background: #ff9a9e;
        border: none;
        color: white;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        width: 100%;
    }
    .new-chat-btn:hover {
        background: #ff7a85;
    }
    .history-list {
        flex: 1;
        overflow-y: auto;
    }
    .history-item {
        padding: 12px;
        border-bottom: 1px solid #f0f0f0;
        cursor: pointer;
        transition: background 0.2s;
    }
    .history-item:hover {
        background: #f9f9f9;
    }
    /* Chat area */
    .chat-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    .chat-header {
        background: linear-gradient(135deg, #ff9a9e, #fad0c4);
        padding: 15px;
        color: white;
        font-size: 1.3em;
        font-weight: 600;
        text-align: center;
        flex-shrink: 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .chat-container {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }
    .message-wrapper {
        display: flex;
        align-items: flex-end;
        margin-bottom: 12px;
    }
    .message {
        max-width: 70%;
        padding: 10px 14px;
        border-radius: 18px;
        word-wrap: break-word;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .bot-message {
        background: white;
        margin-left: 10px;
        border-bottom-left-radius: 5px;
    }
    .user-message {
        background: #ff9a9e;
        color: white;
        margin-right: 10px;
        border-bottom-right-radius: 5px;
    }
    .avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        object-fit: cover;
    }
    .chat-input {
        display: flex;
        padding: 10px;
        background: white;
        border-top: 1px solid #ddd;
        flex-shrink: 0;
    }
    .chat-input input[type="text"] {
        flex: 1;
        padding: 10px;
        border: none;
        outline: none;
        font-size: 1em;
    }
    .chat-input button, .chat-input label {
        background: #ff9a9e;
        border: none;
        color: white;
        padding: 10px 14px;
        font-weight: bold;
        border-radius: 8px;
        cursor: pointer;
        margin-left: 5px;
    }
    input[type="file"] {
        display: none;
    }
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <div class="sidebar-header">
        <button class="new-chat-btn" id="new-chat-btn">+ New Chat</button>
    </div>
    <div class="history-list" id="history-list"></div>
</div>

<!-- Chat Area -->
<div class="chat-wrapper">
    <div class="chat-header">üêæ Pet Behaviour Assistant</div>
    <div class="chat-container" id="chat-container"></div>
    <div class="chat-input">
        <input type="text" id="chat-input" placeholder="Type a message...">
        <label for="file-input">üìé</label>
        <input type="file" id="file-input" accept="image/*,video/*">
        <button id="send-btn">Send</button>
    </div>
</div>

<script>
    const chatContainer = document.getElementById('chat-container');
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    const fileInput = document.getElementById('file-input');
    const historyList = document.getElementById('history-list');
    const newChatBtn = document.getElementById('new-chat-btn');

    let chats = JSON.parse(localStorage.getItem('chats') || '[]');
    let currentChatId = null;

    function saveChats() {
        localStorage.setItem('chats', JSON.stringify(chats));
    }

    function renderHistoryList() {
        historyList.innerHTML = '';
        chats.forEach(chat => {
            const item = document.createElement('div');
            item.classList.add('history-item');
            item.textContent = chat.title || "Untitled Chat";
            item.onclick = () => loadChat(chat.id);
            historyList.appendChild(item);
        });
    }

    function startNewChat() {
        const newChat = {
            id: Date.now(),
            title: '',
            messages: []
        };
        chats.unshift(newChat);
        currentChatId = newChat.id;
        saveChats();
        renderHistoryList();
        renderChatMessages([]);
    
        // Add the first greeting message
        appendMessage(
            "Hi! I‚Äôm here to help you with your pet‚Äôs behaviour. You can type your question or upload an image/video.",
            'bot'
        );
    }    

    function loadChat(id) {
        currentChatId = id;
        const chat = chats.find(c => c.id === id);
        renderChatMessages(chat.messages);
    }

    function renderChatMessages(messages) {
        chatContainer.innerHTML = '';
        messages.forEach(msg => appendMessage(msg.content, msg.sender, msg.type, true));
    }

    function appendMessage(content, sender, type = 'text', skipSave = false) {
        const wrapper = document.createElement('div');
        wrapper.classList.add('message-wrapper');
        if (sender === 'bot') {
            wrapper.innerHTML = `<img src="images/doctor.png" class="avatar">
                <div class="message bot-message">${formatContent(content, type)}</div>`;
        } else {
            wrapper.style.justifyContent = 'flex-end';
            wrapper.innerHTML = `<div class="message user-message">${formatContent(content, type)}</div>
                <img src="images/cat.png" class="avatar">`;
        }
        chatContainer.appendChild(wrapper);
        chatContainer.scrollTop = chatContainer.scrollHeight;

        if (!skipSave && currentChatId) {
            const chat = chats.find(c => c.id === currentChatId);
            chat.messages.push({ sender, content, type });
            if (!chat.title && sender === 'user') {
                chat.title = content.slice(0, 20);
            }
            saveChats();
            renderHistoryList();
        }
    }

    function formatContent(content, type) {
        if (type === 'image') return `<img src="${content}" style="max-width:100%;border-radius:10px;">`;
        if (type === 'video') return `<video src="${content}" controls style="max-width:100%;border-radius:10px;"></video>`;
        return content;
    }

    sendBtn.addEventListener('click', () => {
        const text = chatInput.value.trim();
        if (text && currentChatId) {
            appendMessage(text, 'user');
            chatInput.value = '';
            setTimeout(() => appendMessage("Got it! You said: " + text, 'bot'), 500);
        }
    });

    chatInput.addEventListener('keypress', e => {
        if (e.key === 'Enter') sendBtn.click();
    });

    fileInput.addEventListener('change', () => {
        const file = fileInput.files[0];
        if (!file || !currentChatId) return;
        const fileURL = URL.createObjectURL(file);
        if (file.type.startsWith('image/')) {
            appendMessage(fileURL, 'user', 'image');
            appendMessage("Nice picture!", 'bot');
        } else if (file.type.startsWith('video/')) {
            appendMessage(fileURL, 'user', 'video');
            appendMessage("Thanks for the video!", 'bot');
        }
    });

    newChatBtn.addEventListener('click', startNewChat);

    // Init
    renderHistoryList();
    if (chats.length > 0) {
        loadChat(chats[0].id);
    } else {
        startNewChat();
    }
</script>

</body>
</html>
